<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>BaseTen Reference Manual</title>
    <link href="documentation.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div id="logo-container">
        <a id="logo" href="index.html">
            <img src="http://basetenframework.org/chrome/site/trac_banner.png" alt="">
        </a>
    </div>
    <div class="container">
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="general_usage.html">Using BaseTen framework</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Typically accessing a database consists roughly of the following steps: </p><ul>
<li>
<a class="el" href="getting_started.html#creating_a_database_context">Creating an instance of BXDatabaseContext</a> </li>
<li>
<a class="el" href="getting_started.html#connecting_to_a_database">Connecting to a database</a> </li>
<li>
<a class="el" href="getting_started.html#getting_an_entity_and_a_predicate">Getting an entity description from the context and possibly creating an NSPredicate for reducing the number of fetched objects</a> </li>
<li>
<a class="el" href="getting_started.html#performing_a_fetch">Performing a fetch using the entity and the predicate</a> </li>
<li>
<a class="el" href="getting_started.html#handling_the_results">Handling the results</a> </li>
<li>
<a class="el" href="getting_started.html#creating_objects">Creating new objects</a> </li>
</ul>
<p>Here is a small walkthrough with sample code. More examples are available in the BaseTen Subversion repository and at <a href="http://basetenframework.org">http://basetenframework.org</a>.</p>
  
  <code> #import &lt;Foundation/Foundation.h&gt;
  #import &lt;BaseTen/BaseTen.h&gt;
 
  int main (int argc, char** argv)
  {
      NSURL* databaseURI = [NSURL URLWithString: @"pgsql://username@localhost/database"];
      BXDatabaseContext* ctx = [[BXDatabaseContext alloc] initWithDatabaseURI: databaseURI];
  
      [ctx connectSync: NULL];
      BXEntityDescription* entity = [[ctx databaseObjectModel] entityForTable: @"table"];
      NSArray* result = [ctx executeFetchForEntity: entity withPredicate: nil error: NULL];
 
      for (BXDatabaseObject* object in result)
      {
          NSLog (@"Object ID: %@ column: %@", 
                 [[object objectID] URIRepresentation], [object valueForKey: @"column"]);
      }
 
      NSDictionary* values = [NSDictionary dictionaryWithObject: @"newValue" forKey: @"column"];
      BXDatabaseObject* newObject = [ctx createObjectForEntity: entity withFieldValues: values error: NULL];
      NSLog (@"new object: %@", newObject);
 
      return 0;
  }</code>
  </p>
<h1><a class="anchor" id="creating_a_database_context"></a>
Creating a database context</h1>
<p>The designated initializer of BXDatabaseContext is -initWithDatabaseURI:. -init is also available but the context does require an URI before connecting.</p>
<p>BXDatabaseContext requires the URI to be formatted as follows:<br />
 <code>pgsql://username:password@host/database_name</code>. Currently, as PostgreSQL is the only supported database, only <code>pgsql://</code> URIs are allowed. In command line tools, all parameters are required except for the password, the need for which depends on the database configuration.</p>
<p>Various methods in BXDatabaseContext take a double pointer to an NSError object as a parameter. if the called method fails, the NSError will be set on return. If the parameter is NULL, the default error handler raises a <a class="el" href="interface_b_x_exception.html" title="A BaseTen-specific exception. ">BXException</a>. BXDatabaseContext's delegate may change this behaviour.</p>
<h1><a class="anchor" id="connecting_to_a_database"></a>
Connecting to a database</h1>
  
  <code>[ctx connectSync: NULL];</code>
  </p>
<p>Connection to the database may be made synchronously using the method -connectSync. Applications that use an NSRunLoop also have the option to use -connectAsync. The method returns immediately. When the connection attempt has finished, the context's delegate will be called and notifications will be posted to the context's notification center (accessed with -notificationCenter).</p>
<p>In AppKit applications, the easiest way to connect to the database is to use the IBAction -connect:. In addition to attempting the connection asynchronously, it also presents a number of panels to the user, if some required information is missing from the URI. The panels allow the user to specify their username, password and the database host making URIs like <code>pgsql:///<em>database_name</em></code> allowed. Additionally a <em>kBXConnectionSetupAlertDidEndNotification</em> will be posted when the user dismisses an alert panel, which is presented on failure.</p>
<p>Since <em>NULL</em> is passed in place of an NSError double pointer, a <a class="el" href="interface_b_x_exception.html" title="A BaseTen-specific exception. ">BXException</a> will be thrown on error. See BXDatabaseContext's documentation for details on error handling.</p>
<h1><a class="anchor" id="getting_an_entity_and_a_predicate"></a>
Getting a BXEntityDescription and an NSPredicate</h1>
  
  <code>BXEntityDescription* entity = [[ctx databaseObjectModel] entityForTable: @"table"];</code>
  </p>
<p>BXEntityDescriptions are used to specify tables for fetches. For getting a specific entity description, <a class="el" href="interface_b_x_database_object_model.html" title="The database object model. ">BXDatabaseObjectModel</a> has two methods: -entityForTable: and -entityForTable:inSchema:. Entity descriptions may be accessed before making a connection in which case the database context will check their existence on connect.</p>
<p>NSPredicates are created by various Cocoa objects and may be passed directly to BXDatabaseContext. One way to create ad-hoc predicates is by using NSPredicate's method -predicateWithFormat:. In this example, we fetch all the objects instead of filtering them, though.</p>
<h1><a class="anchor" id="performing_a_fetch"></a>
Performing a fetch using the entity and the predicate</h1>
  
  <code>NSArray* result = [ctx executeFetchForEntity: entity withPredicate: nil error: NULL];</code>
  </p>
<p>BXDatabaseContext's method -executeFetchForEntity:withPredicate:error: and its variations may be used to fetch objects from the database. The method takes a <a class="el" href="interface_b_x_entity_description.html" title="An entity description contains information about a specific table or view in a given database...">BXEntityDescription</a> and an NSPredicate and performs a fetch synchronously. The fetched objects are returned in an NSArray.</p>
<h1><a class="anchor" id="handling_the_results"></a>
Handling the results</h1>
  
  <code>for (BXDatabaseObject* object in result)
*{
     NSLog (@"Object ID: %@ column: %@", 
            [[object objectID] URIRepresentation], [object valueForKey: @"column"]);
*}</code>
  </p>
<p>Since <a class="el" href="interface_b_x_database_object.html" title="A class that represents a single row in a database table. ">BXDatabaseObject</a> conforms to <em>NSKeyValueObserving</em>, methods -valueForKey: and -setValue:forKey: are available. See <a class="el" href="accessing_values.html">Accessing object values</a> for details.</p>
<h1><a class="anchor" id="creating_objects"></a>
Creating a new object</h1>
  
  <code>NSDictionary* values = [NSDictionary dictionaryWithObject: @"newValue" forKey: @"column"];
  BXDatabaseObject* newObject = [ctx createObjectForEntity: entity withFieldValues: values error: NULL];
  NSLog (@"new object: %@", newObject);</code>
  </p>
<p>New rows are inserted with BXDatabaseContext's method -createObjectForEntity:withFieldValues:error:. The values dictionary may contain initial values for both attributes and to-one relationships in case the target entity contains the foreign key. </p>
</div></div><!-- contents -->
</div>
<div class="footer"></div>
</body>
</html>

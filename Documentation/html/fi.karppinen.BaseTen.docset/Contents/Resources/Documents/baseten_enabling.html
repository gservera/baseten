<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>BaseTen Reference Manual</title>
    <link href="documentation.css" rel="stylesheet" type="text/css">
</head>
<body>
    <div id="logo-container">
        <a id="logo" href="index.html">
            <img src="http://basetenframework.org/chrome/site/trac_banner.png" alt="">
        </a>
    </div>
    <div class="container">
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="database_usage.html">Database administration</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Enabling relations for use with BaseTen </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Some tables are created in BaseTen schema to track changes in other relations and storing relationships between tables and views. The association is based on relation names.</p>
<p>While this arrangement allows clients to fault only changed objects, it has some unfortunate side effects: </p><ul>
<li>Altering relations' names after having them enabled will not work. To rename relations, they need to be disabled first and re-enabled afterwards. </li>
<li>Altering relations' primary keys will not work. Again, disabling and re-enabling is required. </li>
<li>Altering relations' columns will not work. Again, disabling and re-enabling is required. </li>
<li>Altering relations' foreign keys causes BaseTen's relationship information to become out-of-date and needing to be refreshed.</li>
</ul>
<p>All this can be done using BaseTen Assistant.</p>
<dl class="section note"><dt>Note</dt><dd>In version 1.5, relations and BaseTen's tables were associated with each other based on relation names. This didn't work for all names, though, and made renaming enabled relations impossible. In versions 1.6 through 1.6.2, the association was based on relation oids. While this made renaming relations possible, it also made dumping database contents exceedingly difficult.</dd></dl>
<h1><a class="anchor" id="sql_enabling"></a>
Enabling relations and updating relationship cache using SQL functions</h1>
<p>In addition to using BaseTen Assistant, it is possible to enable and disable tables with SQL functions. The functions are <em>baseten.enable (oid)</em> and <em>baseten.disable (oid)</em>. The object identifier argument can be looked up from PostgreSQL's system tables, <em>pg_class</em> and <em>pg_namespace</em>.</p>
<p>Views' primary keys are stored in <em>baseten.view_pkey</em>. The table has three columns: <em>nspname</em>, <em>relname</em> and <em>attname</em>, which correspond to the view's schema name, the view's name and each primary key column's name respectively. To enable a view, its primary key needs to be specified first.</p>
<p>Relationships and view hierarchies among other things are stored in automatically-generated tables. These should be refreshed with the SQL function <em>baseten.refresh_caches ()</em> after all changes to views, primary keys and foreign keys. </p>
</div></div><!-- contents -->
</div>
<div class="footer"></div>
</body>
</html>
